FROM python:3.11-slim

# Install Tesseract OCR and Poppler for PDF processing
RUN apt-get update && apt-get install -y \
    tesseract-ocr \
    poppler-utils \
    curl \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy requirements
COPY requirements.txt .

# Install additional dependencies for local mode
RUN pip install --no-cache-dir -r requirements.txt \
    && pip install --no-cache-dir pytesseract pillow pdf2image

# Copy application code
COPY . .

# Create storage directory
RUN mkdir -p /app/storage

# Expose port
EXPOSE 5001

# Run the local version
CMD ["python", "app_local.py"]
